.include "macros.inc"
.section .text, "ax"  # 0x80005560 - 0x80221F60
WriteCallback:
/* 8020C6EC 0020964C  7C 08 02 A6 */	mflr r0
/* 8020C6F0 00209650  90 01 00 04 */	stw r0, 4(r1)
/* 8020C6F4 00209654  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8020C6F8 00209658  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 8020C6FC 0020965C  93 C1 00 18 */	stw r30, 0x18(r1)
/* 8020C700 00209660  3B C3 00 00 */	addi r30, r3, 0
/* 8020C704 00209664  3C 60 80 3D */	lis r3, __CARDBlock@ha
/* 8020C708 00209668  93 A1 00 14 */	stw r29, 0x14(r1)
/* 8020C70C 0020966C  1C BE 01 08 */	mulli r5, r30, 0x108
/* 8020C710 00209670  93 81 00 10 */	stw r28, 0x10(r1)
/* 8020C714 00209674  38 03 34 20 */	addi r0, r3, __CARDBlock@l
/* 8020C718 00209678  7C 9C 23 79 */	or. r28, r4, r4
/* 8020C71C 0020967C  7F E0 2A 14 */	add r31, r0, r5
/* 8020C720 00209680  41 80 00 F0 */	blt .L_8020C810
/* 8020C724 00209684  83 BF 00 C0 */	lwz r29, 0xc0(r31)
/* 8020C728 00209688  80 7D 00 0C */	lwz r3, 0xc(r29)
/* 8020C72C 0020968C  2C 03 00 00 */	cmpwi r3, 0
/* 8020C730 00209690  40 80 00 0C */	bge .L_8020C73C
/* 8020C734 00209694  3B 80 FF F2 */	li r28, -14
/* 8020C738 00209698  48 00 00 D8 */	b .L_8020C810
.L_8020C73C:
/* 8020C73C 0020969C  80 1F 00 0C */	lwz r0, 0xc(r31)
/* 8020C740 002096A0  7C 00 18 50 */	subf r0, r0, r3
/* 8020C744 002096A4  90 1D 00 0C */	stw r0, 0xc(r29)
/* 8020C748 002096A8  80 1D 00 0C */	lwz r0, 0xc(r29)
/* 8020C74C 002096AC  2C 00 00 00 */	cmpwi r0, 0
/* 8020C750 002096B0  41 81 00 54 */	bgt .L_8020C7A4
/* 8020C754 002096B4  7F E3 FB 78 */	mr r3, r31
/* 8020C758 002096B8  4B FF D1 59 */	bl __CARDGetDirBlock
/* 8020C75C 002096BC  80 BD 00 04 */	lwz r5, 4(r29)
/* 8020C760 002096C0  3C 80 80 00 */	lis r4, 0x800000F8@ha
/* 8020C764 002096C4  80 04 00 F8 */	lwz r0, 0x800000F8@l(r4)
/* 8020C768 002096C8  54 A4 30 32 */	slwi r4, r5, 6
/* 8020C76C 002096CC  7F 83 22 14 */	add r28, r3, r4
/* 8020C770 002096D0  54 1D F0 BE */	srwi r29, r0, 2
/* 8020C774 002096D4  4B FF 0C 2D */	bl OSGetTime
/* 8020C778 002096D8  38 DD 00 00 */	addi r6, r29, 0
/* 8020C77C 002096DC  38 A0 00 00 */	li r5, 0
/* 8020C780 002096E0  48 00 88 29 */	bl __div2i
/* 8020C784 002096E4  90 9C 00 28 */	stw r4, 0x28(r28)
/* 8020C788 002096E8  38 00 00 00 */	li r0, 0
/* 8020C78C 002096EC  38 7E 00 00 */	addi r3, r30, 0
/* 8020C790 002096F0  80 9F 00 D0 */	lwz r4, 0xd0(r31)
/* 8020C794 002096F4  90 1F 00 D0 */	stw r0, 0xd0(r31)
/* 8020C798 002096F8  4B FF D2 B9 */	bl __CARDUpdateDir
/* 8020C79C 002096FC  7C 7C 1B 78 */	mr r28, r3
/* 8020C7A0 00209700  48 00 00 68 */	b .L_8020C808
.L_8020C7A4:
/* 8020C7A4 00209704  7F E3 FB 78 */	mr r3, r31
/* 8020C7A8 00209708  4B FF CD 05 */	bl __CARDGetFatBlock
/* 8020C7AC 0020970C  80 9D 00 08 */	lwz r4, 8(r29)
/* 8020C7B0 00209710  80 1F 00 0C */	lwz r0, 0xc(r31)
/* 8020C7B4 00209714  7C 04 02 14 */	add r0, r4, r0
/* 8020C7B8 00209718  90 1D 00 08 */	stw r0, 8(r29)
/* 8020C7BC 0020971C  A0 1D 00 10 */	lhz r0, 0x10(r29)
/* 8020C7C0 00209720  54 00 08 3C */	slwi r0, r0, 1
/* 8020C7C4 00209724  7C 03 02 2E */	lhzx r0, r3, r0
/* 8020C7C8 00209728  B0 1D 00 10 */	sth r0, 0x10(r29)
/* 8020C7CC 0020972C  A0 9D 00 10 */	lhz r4, 0x10(r29)
/* 8020C7D0 00209730  28 04 00 05 */	cmplwi r4, 5
/* 8020C7D4 00209734  41 80 00 10 */	blt .L_8020C7E4
/* 8020C7D8 00209738  A0 1F 00 10 */	lhz r0, 0x10(r31)
/* 8020C7DC 0020973C  7C 04 00 40 */	cmplw r4, r0
/* 8020C7E0 00209740  41 80 00 0C */	blt .L_8020C7EC
.L_8020C7E4:
/* 8020C7E4 00209744  3B 80 FF FA */	li r28, -6
/* 8020C7E8 00209748  48 00 00 28 */	b .L_8020C810
.L_8020C7EC:
/* 8020C7EC 0020974C  80 1F 00 0C */	lwz r0, 0xc(r31)
/* 8020C7F0 00209750  3C 60 80 21 */	lis r3, EraseCallback@ha
/* 8020C7F4 00209754  38 A3 C8 5C */	addi r5, r3, EraseCallback@l
/* 8020C7F8 00209758  7C 80 21 D6 */	mullw r4, r0, r4
/* 8020C7FC 0020975C  38 7E 00 00 */	addi r3, r30, 0
/* 8020C800 00209760  4B FF C4 E9 */	bl __CARDEraseSector
/* 8020C804 00209764  7C 7C 1B 78 */	mr r28, r3
.L_8020C808:
/* 8020C808 00209768  2C 1C 00 00 */	cmpwi r28, 0
/* 8020C80C 0020976C  40 80 00 30 */	bge .L_8020C83C
.L_8020C810:
/* 8020C810 00209770  83 BF 00 D0 */	lwz r29, 0xd0(r31)
/* 8020C814 00209774  38 00 00 00 */	li r0, 0
/* 8020C818 00209778  38 7F 00 00 */	addi r3, r31, 0
/* 8020C81C 0020977C  90 1F 00 D0 */	stw r0, 0xd0(r31)
/* 8020C820 00209780  7F 84 E3 78 */	mr r4, r28
/* 8020C824 00209784  4B FF C6 FD */	bl __CARDPutControlBlock
/* 8020C828 00209788  39 9D 00 00 */	addi r12, r29, 0
/* 8020C82C 0020978C  7D 88 03 A6 */	mtlr r12
/* 8020C830 00209790  38 7E 00 00 */	addi r3, r30, 0
/* 8020C834 00209794  38 9C 00 00 */	addi r4, r28, 0
/* 8020C838 00209798  4E 80 00 21 */	blrl 
.L_8020C83C:
/* 8020C83C 0020979C  80 01 00 24 */	lwz r0, 0x24(r1)
/* 8020C840 002097A0  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 8020C844 002097A4  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 8020C848 002097A8  7C 08 03 A6 */	mtlr r0
/* 8020C84C 002097AC  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 8020C850 002097B0  83 81 00 10 */	lwz r28, 0x10(r1)
/* 8020C854 002097B4  38 21 00 20 */	addi r1, r1, 0x20
/* 8020C858 002097B8  4E 80 00 20 */	blr 

EraseCallback:
/* 8020C85C 002097BC  7C 08 02 A6 */	mflr r0
/* 8020C860 002097C0  90 01 00 04 */	stw r0, 4(r1)
/* 8020C864 002097C4  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8020C868 002097C8  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 8020C86C 002097CC  93 C1 00 18 */	stw r30, 0x18(r1)
/* 8020C870 002097D0  93 A1 00 14 */	stw r29, 0x14(r1)
/* 8020C874 002097D4  7C 9D 23 79 */	or. r29, r4, r4
/* 8020C878 002097D8  93 81 00 10 */	stw r28, 0x10(r1)
/* 8020C87C 002097DC  3B 83 00 00 */	addi r28, r3, 0
/* 8020C880 002097E0  1C BC 01 08 */	mulli r5, r28, 0x108
/* 8020C884 002097E4  3C 60 80 3D */	lis r3, __CARDBlock@ha
/* 8020C888 002097E8  38 03 34 20 */	addi r0, r3, __CARDBlock@l
/* 8020C88C 002097EC  7F E0 2A 14 */	add r31, r0, r5
/* 8020C890 002097F0  41 80 00 30 */	blt .L_8020C8C0
/* 8020C894 002097F4  80 9F 00 C0 */	lwz r4, 0xc0(r31)
/* 8020C898 002097F8  3C 60 80 21 */	lis r3, WriteCallback@ha
/* 8020C89C 002097FC  38 E3 C6 EC */	addi r7, r3, WriteCallback@l
/* 8020C8A0 00209800  80 BF 00 0C */	lwz r5, 0xc(r31)
/* 8020C8A4 00209804  A0 04 00 10 */	lhz r0, 0x10(r4)
/* 8020C8A8 00209808  80 DF 00 B4 */	lwz r6, 0xb4(r31)
/* 8020C8AC 0020980C  38 7C 00 00 */	addi r3, r28, 0
/* 8020C8B0 00209810  7C 85 01 D6 */	mullw r4, r5, r0
/* 8020C8B4 00209814  4B FF CB 7D */	bl __CARDWrite
/* 8020C8B8 00209818  7C 7D 1B 79 */	or. r29, r3, r3
/* 8020C8BC 0020981C  40 80 00 30 */	bge .L_8020C8EC
.L_8020C8C0:
/* 8020C8C0 00209820  83 DF 00 D0 */	lwz r30, 0xd0(r31)
/* 8020C8C4 00209824  38 00 00 00 */	li r0, 0
/* 8020C8C8 00209828  38 7F 00 00 */	addi r3, r31, 0
/* 8020C8CC 0020982C  90 1F 00 D0 */	stw r0, 0xd0(r31)
/* 8020C8D0 00209830  7F A4 EB 78 */	mr r4, r29
/* 8020C8D4 00209834  4B FF C6 4D */	bl __CARDPutControlBlock
/* 8020C8D8 00209838  39 9E 00 00 */	addi r12, r30, 0
/* 8020C8DC 0020983C  7D 88 03 A6 */	mtlr r12
/* 8020C8E0 00209840  38 7C 00 00 */	addi r3, r28, 0
/* 8020C8E4 00209844  38 9D 00 00 */	addi r4, r29, 0
/* 8020C8E8 00209848  4E 80 00 21 */	blrl 
.L_8020C8EC:
/* 8020C8EC 0020984C  80 01 00 24 */	lwz r0, 0x24(r1)
/* 8020C8F0 00209850  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 8020C8F4 00209854  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 8020C8F8 00209858  7C 08 03 A6 */	mtlr r0
/* 8020C8FC 0020985C  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 8020C900 00209860  83 81 00 10 */	lwz r28, 0x10(r1)
/* 8020C904 00209864  38 21 00 20 */	addi r1, r1, 0x20
/* 8020C908 00209868  4E 80 00 20 */	blr 

.global CARDWriteAsync
CARDWriteAsync:
/* 8020C90C 0020986C  7C 08 02 A6 */	mflr r0
/* 8020C910 00209870  90 01 00 04 */	stw r0, 4(r1)
/* 8020C914 00209874  94 21 FF C8 */	stwu r1, -0x38(r1)
/* 8020C918 00209878  BF 61 00 24 */	stmw r27, 0x24(r1)
/* 8020C91C 0020987C  3B 86 00 00 */	addi r28, r6, 0
/* 8020C920 00209880  3B 65 00 00 */	addi r27, r5, 0
/* 8020C924 00209884  3B E4 00 00 */	addi r31, r4, 0
/* 8020C928 00209888  3B C3 00 00 */	addi r30, r3, 0
/* 8020C92C 0020988C  3B A7 00 00 */	addi r29, r7, 0
/* 8020C930 00209890  38 9B 00 00 */	addi r4, r27, 0
/* 8020C934 00209894  38 BC 00 00 */	addi r5, r28, 0
/* 8020C938 00209898  38 C1 00 1C */	addi r6, r1, 0x1c
/* 8020C93C 0020989C  4B FF F9 3D */	bl __CARDSeek
/* 8020C940 002098A0  2C 03 00 00 */	cmpwi r3, 0
/* 8020C944 002098A4  40 80 00 08 */	bge .L_8020C94C
/* 8020C948 002098A8  48 00 00 C0 */	b .L_8020CA08
.L_8020C94C:
/* 8020C94C 002098AC  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 8020C950 002098B0  80 83 00 0C */	lwz r4, 0xc(r3)
/* 8020C954 002098B4  38 84 FF FF */	addi r4, r4, -1
/* 8020C958 002098B8  7F 80 20 39 */	and. r0, r28, r4
/* 8020C95C 002098BC  40 82 00 0C */	bne .L_8020C968
/* 8020C960 002098C0  7F 60 20 39 */	and. r0, r27, r4
/* 8020C964 002098C4  41 82 00 10 */	beq .L_8020C974
.L_8020C968:
/* 8020C968 002098C8  38 80 FF 80 */	li r4, -128
/* 8020C96C 002098CC  4B FF C5 B5 */	bl __CARDPutControlBlock
/* 8020C970 002098D0  48 00 00 98 */	b .L_8020CA08
.L_8020C974:
/* 8020C974 002098D4  4B FF CF 3D */	bl __CARDGetDirBlock
/* 8020C978 002098D8  80 1E 00 04 */	lwz r0, 4(r30)
/* 8020C97C 002098DC  54 00 30 32 */	slwi r0, r0, 6
/* 8020C980 002098E0  7C 63 02 14 */	add r3, r3, r0
/* 8020C984 002098E4  4B FF F1 65 */	bl __CARDAccess
/* 8020C988 002098E8  7C 64 1B 79 */	or. r4, r3, r3
/* 8020C98C 002098EC  40 80 00 10 */	bge .L_8020C99C
/* 8020C990 002098F0  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 8020C994 002098F4  4B FF C5 8D */	bl __CARDPutControlBlock
/* 8020C998 002098F8  48 00 00 70 */	b .L_8020CA08
.L_8020C99C:
/* 8020C99C 002098FC  38 7F 00 00 */	addi r3, r31, 0
/* 8020C9A0 00209900  38 9B 00 00 */	addi r4, r27, 0
/* 8020C9A4 00209904  4B FE A2 79 */	bl DCStoreRange
/* 8020C9A8 00209908  28 1D 00 00 */	cmplwi r29, 0
/* 8020C9AC 0020990C  41 82 00 0C */	beq .L_8020C9B8
/* 8020C9B0 00209910  7F A0 EB 78 */	mr r0, r29
/* 8020C9B4 00209914  48 00 00 0C */	b .L_8020C9C0
.L_8020C9B8:
/* 8020C9B8 00209918  3C 60 80 20 */	lis r3, __CARDDefaultApiCallback@ha
/* 8020C9BC 0020991C  38 03 7E 60 */	addi r0, r3, __CARDDefaultApiCallback@l
.L_8020C9C0:
/* 8020C9C0 00209920  80 81 00 1C */	lwz r4, 0x1c(r1)
/* 8020C9C4 00209924  3C 60 80 21 */	lis r3, EraseCallback@ha
/* 8020C9C8 00209928  38 A3 C8 5C */	addi r5, r3, EraseCallback@l
/* 8020C9CC 0020992C  90 04 00 D0 */	stw r0, 0xd0(r4)
/* 8020C9D0 00209930  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 8020C9D4 00209934  93 E3 00 B4 */	stw r31, 0xb4(r3)
/* 8020C9D8 00209938  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 8020C9DC 0020993C  A0 1E 00 10 */	lhz r0, 0x10(r30)
/* 8020C9E0 00209940  80 83 00 0C */	lwz r4, 0xc(r3)
/* 8020C9E4 00209944  80 7E 00 00 */	lwz r3, 0(r30)
/* 8020C9E8 00209948  7C 84 01 D6 */	mullw r4, r4, r0
/* 8020C9EC 0020994C  4B FF C2 FD */	bl __CARDEraseSector
/* 8020C9F0 00209950  7C 7E 1B 79 */	or. r30, r3, r3
/* 8020C9F4 00209954  40 80 00 10 */	bge .L_8020CA04
/* 8020C9F8 00209958  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 8020C9FC 0020995C  7F C4 F3 78 */	mr r4, r30
/* 8020CA00 00209960  4B FF C5 21 */	bl __CARDPutControlBlock
.L_8020CA04:
/* 8020CA04 00209964  7F C3 F3 78 */	mr r3, r30
.L_8020CA08:
/* 8020CA08 00209968  BB 61 00 24 */	lmw r27, 0x24(r1)
/* 8020CA0C 0020996C  80 01 00 3C */	lwz r0, 0x3c(r1)
/* 8020CA10 00209970  38 21 00 38 */	addi r1, r1, 0x38
/* 8020CA14 00209974  7C 08 03 A6 */	mtlr r0
/* 8020CA18 00209978  4E 80 00 20 */	blr 

.global CARDWrite
CARDWrite:
/* 8020CA1C 0020997C  7C 08 02 A6 */	mflr r0
/* 8020CA20 00209980  3C E0 80 20 */	lis r7, __CARDSyncCallback@ha
/* 8020CA24 00209984  90 01 00 04 */	stw r0, 4(r1)
/* 8020CA28 00209988  38 E7 7E 64 */	addi r7, r7, __CARDSyncCallback@l
/* 8020CA2C 0020998C  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8020CA30 00209990  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 8020CA34 00209994  3B E3 00 00 */	addi r31, r3, 0
/* 8020CA38 00209998  4B FF FE D5 */	bl CARDWriteAsync
/* 8020CA3C 0020999C  2C 03 00 00 */	cmpwi r3, 0
/* 8020CA40 002099A0  40 80 00 08 */	bge .L_8020CA48
/* 8020CA44 002099A4  48 00 00 0C */	b .L_8020CA50
.L_8020CA48:
/* 8020CA48 002099A8  80 7F 00 00 */	lwz r3, 0(r31)
/* 8020CA4C 002099AC  4B FF C6 E1 */	bl __CARDSync
.L_8020CA50:
/* 8020CA50 002099B0  80 01 00 24 */	lwz r0, 0x24(r1)
/* 8020CA54 002099B4  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 8020CA58 002099B8  38 21 00 20 */	addi r1, r1, 0x20
/* 8020CA5C 002099BC  7C 08 03 A6 */	mtlr r0
/* 8020CA60 002099C0  4E 80 00 20 */	blr 
