.include "macros.inc"
.section .text, "ax"  # 0x80005560 - 0x80221F60
.global OSAllocFromHeap
OSAllocFromHeap:
/* 801F67AC 001F370C  1C 03 00 0C */	mulli r0, r3, 0xc
/* 801F67B0 001F3710  80 6D 31 E0 */	lwz r3, HeapArray@sda21(r13)
/* 801F67B4 001F3714  7C A3 02 14 */	add r5, r3, r0
/* 801F67B8 001F3718  38 04 00 3F */	addi r0, r4, 0x3f
/* 801F67BC 001F371C  80 C5 00 04 */	lwz r6, 4(r5)
/* 801F67C0 001F3720  54 03 00 34 */	rlwinm r3, r0, 0, 0, 0x1a
/* 801F67C4 001F3724  48 00 00 14 */	b lbl_801F67D8
lbl_801F67C8:
/* 801F67C8 001F3728  80 06 00 08 */	lwz r0, 8(r6)
/* 801F67CC 001F372C  7C 03 00 00 */	cmpw r3, r0
/* 801F67D0 001F3730  40 81 00 10 */	ble lbl_801F67E0
/* 801F67D4 001F3734  80 C6 00 04 */	lwz r6, 4(r6)
lbl_801F67D8:
/* 801F67D8 001F3738  28 06 00 00 */	cmplwi r6, 0
/* 801F67DC 001F373C  40 82 FF EC */	bne lbl_801F67C8
lbl_801F67E0:
/* 801F67E0 001F3740  28 06 00 00 */	cmplwi r6, 0
/* 801F67E4 001F3744  40 82 00 0C */	bne lbl_801F67F0
/* 801F67E8 001F3748  38 60 00 00 */	li r3, 0
/* 801F67EC 001F374C  4E 80 00 20 */	blr 
lbl_801F67F0:
/* 801F67F0 001F3750  80 06 00 08 */	lwz r0, 8(r6)
/* 801F67F4 001F3754  7C 03 00 50 */	subf r0, r3, r0
/* 801F67F8 001F3758  28 00 00 40 */	cmplwi r0, 0x40
/* 801F67FC 001F375C  40 80 00 40 */	bge lbl_801F683C
/* 801F6800 001F3760  80 86 00 04 */	lwz r4, 4(r6)
/* 801F6804 001F3764  80 65 00 04 */	lwz r3, 4(r5)
/* 801F6808 001F3768  28 04 00 00 */	cmplwi r4, 0
/* 801F680C 001F376C  41 82 00 0C */	beq lbl_801F6818
/* 801F6810 001F3770  80 06 00 00 */	lwz r0, 0(r6)
/* 801F6814 001F3774  90 04 00 00 */	stw r0, 0(r4)
lbl_801F6818:
/* 801F6818 001F3778  80 86 00 00 */	lwz r4, 0(r6)
/* 801F681C 001F377C  28 04 00 00 */	cmplwi r4, 0
/* 801F6820 001F3780  40 82 00 0C */	bne lbl_801F682C
/* 801F6824 001F3784  80 66 00 04 */	lwz r3, 4(r6)
/* 801F6828 001F3788  48 00 00 0C */	b lbl_801F6834
lbl_801F682C:
/* 801F682C 001F378C  80 06 00 04 */	lwz r0, 4(r6)
/* 801F6830 001F3790  90 04 00 04 */	stw r0, 4(r4)
lbl_801F6834:
/* 801F6834 001F3794  90 65 00 04 */	stw r3, 4(r5)
/* 801F6838 001F3798  48 00 00 48 */	b lbl_801F6880
lbl_801F683C:
/* 801F683C 001F379C  90 66 00 08 */	stw r3, 8(r6)
/* 801F6840 001F37A0  7C 86 1A 14 */	add r4, r6, r3
/* 801F6844 001F37A4  90 04 00 08 */	stw r0, 8(r4)
/* 801F6848 001F37A8  80 06 00 00 */	lwz r0, 0(r6)
/* 801F684C 001F37AC  90 04 00 00 */	stw r0, 0(r4)
/* 801F6850 001F37B0  80 06 00 04 */	lwz r0, 4(r6)
/* 801F6854 001F37B4  90 04 00 04 */	stw r0, 4(r4)
/* 801F6858 001F37B8  80 64 00 04 */	lwz r3, 4(r4)
/* 801F685C 001F37BC  28 03 00 00 */	cmplwi r3, 0
/* 801F6860 001F37C0  41 82 00 08 */	beq lbl_801F6868
/* 801F6864 001F37C4  90 83 00 00 */	stw r4, 0(r3)
lbl_801F6868:
/* 801F6868 001F37C8  80 64 00 00 */	lwz r3, 0(r4)
/* 801F686C 001F37CC  28 03 00 00 */	cmplwi r3, 0
/* 801F6870 001F37D0  41 82 00 0C */	beq lbl_801F687C
/* 801F6874 001F37D4  90 83 00 04 */	stw r4, 4(r3)
/* 801F6878 001F37D8  48 00 00 08 */	b lbl_801F6880
lbl_801F687C:
/* 801F687C 001F37DC  90 85 00 04 */	stw r4, 4(r5)
lbl_801F6880:
/* 801F6880 001F37E0  80 65 00 08 */	lwz r3, 8(r5)
/* 801F6884 001F37E4  38 00 00 00 */	li r0, 0
/* 801F6888 001F37E8  90 66 00 04 */	stw r3, 4(r6)
/* 801F688C 001F37EC  28 03 00 00 */	cmplwi r3, 0
/* 801F6890 001F37F0  90 06 00 00 */	stw r0, 0(r6)
/* 801F6894 001F37F4  41 82 00 08 */	beq lbl_801F689C
/* 801F6898 001F37F8  90 C3 00 00 */	stw r6, 0(r3)
lbl_801F689C:
/* 801F689C 001F37FC  90 C5 00 08 */	stw r6, 8(r5)
/* 801F68A0 001F3800  38 66 00 20 */	addi r3, r6, 0x20
/* 801F68A4 001F3804  4E 80 00 20 */	blr 

.global OSInitAlloc
OSInitAlloc:
/* 801F68A8 001F3808  1C E5 00 0C */	mulli r7, r5, 0xc
/* 801F68AC 001F380C  90 6D 31 E0 */	stw r3, HeapArray@sda21(r13)
/* 801F68B0 001F3810  90 AD 31 E4 */	stw r5, NumHeaps@sda21(r13)
/* 801F68B4 001F3814  38 C0 00 00 */	li r6, 0
/* 801F68B8 001F3818  38 66 00 00 */	addi r3, r6, 0
/* 801F68BC 001F381C  39 00 00 00 */	li r8, 0
/* 801F68C0 001F3820  38 A0 FF FF */	li r5, -1
/* 801F68C4 001F3824  48 00 00 20 */	b lbl_801F68E4
lbl_801F68C8:
/* 801F68C8 001F3828  80 0D 31 E0 */	lwz r0, HeapArray@sda21(r13)
/* 801F68CC 001F382C  39 08 00 01 */	addi r8, r8, 1
/* 801F68D0 001F3830  7D 20 32 14 */	add r9, r0, r6
/* 801F68D4 001F3834  90 A9 00 00 */	stw r5, 0(r9)
/* 801F68D8 001F3838  38 C6 00 0C */	addi r6, r6, 0xc
/* 801F68DC 001F383C  90 69 00 08 */	stw r3, 8(r9)
/* 801F68E0 001F3840  90 69 00 04 */	stw r3, 4(r9)
lbl_801F68E4:
/* 801F68E4 001F3844  80 0D 31 E4 */	lwz r0, NumHeaps@sda21(r13)
/* 801F68E8 001F3848  7C 08 00 00 */	cmpw r8, r0
/* 801F68EC 001F384C  41 80 FF DC */	blt lbl_801F68C8
/* 801F68F0 001F3850  80 6D 31 E0 */	lwz r3, HeapArray@sda21(r13)
/* 801F68F4 001F3854  54 80 00 34 */	rlwinm r0, r4, 0, 0, 0x1a
/* 801F68F8 001F3858  38 80 FF FF */	li r4, -1
/* 801F68FC 001F385C  90 0D 31 EC */	stw r0, ArenaEnd@sda21(r13)
/* 801F6900 001F3860  7C 63 3A 14 */	add r3, r3, r7
/* 801F6904 001F3864  38 03 00 1F */	addi r0, r3, 0x1f
/* 801F6908 001F3868  90 8D 29 D8 */	stw r4, __OSCurrHeap@sda21(r13)
/* 801F690C 001F386C  54 03 00 34 */	rlwinm r3, r0, 0, 0, 0x1a
/* 801F6910 001F3870  90 6D 31 E8 */	stw r3, ArenaStart@sda21(r13)
/* 801F6914 001F3874  4E 80 00 20 */	blr 

.section .sdata, "wa"  # 0x803DCD20 - 0x803E7820
.balign 0x8
.global __OSCurrHeap
__OSCurrHeap:
	.4byte 0xFFFFFFFF

.section .sbss, "wa"
.balign 0x8
.global HeapArray
HeapArray:
	.skip 0x4
.global NumHeaps
NumHeaps:
	.skip 0x4
.global ArenaStart
ArenaStart:
	.skip 0x4
.global ArenaEnd
ArenaEnd:
	.skip 0x4
